---
layout: post
title: Simple VM reporting in vCloud with PowerCLI
tags:
- Bluelock
- PowerCLI
- reporting
- vApp
- vCloud
- Virtual machine
- vmware
status: publish
type: post
published: true
meta:
  _wpas_mess: ! 'New Post: Simple VM reporting in #vCloud with #PowerCLI'
  publicize_twitter_user: jakerobinson
  _wpas_done_209084: '1'
  _publicize_done_external: a:1:{s:7:"twitter";a:1:{i:14061017;b:1;}}
---
Because of the unique requirement of VMs to exist inside vApps in vCloud Director, it's a challenge to get a nice view of all the VMs and their locations within your vCloud Organization. This can mostly be satisfied with a <span style="color:#3366ff;">Get-CIVM</span> command, which will return great info about your VMs, but it's missing the storage assignment. Here's a sweet little script to report specifically on the VM resources in use inside your vCloud Organization:

[sourcecode language="powershell"]

$vms = get-civm
$objects = @()

foreach($vm in $vms)
{
 $hardware = $vm.ExtensionData.GetVirtualHardwareSection()
 $diskMB = (($hardware.Item | where {$_.resourcetype.value -eq &quot;17&quot;}) | %{$_.hostresource[0].anyattr[0].&quot;#text&quot;} | Measure-Object -Sum).sum
 $row = New-Object PSObject -Property @{&quot;vapp&quot; = $vm.vapp; &quot;name&quot;=$vm.Name;&quot;cpuCount&quot;=$vm.CpuCount;&quot;memoryGB&quot;=$vm.MemoryGB;&quot;storageGB&quot;=($diskMB/1024)}
 $objects += $row
}

# Use select object to get the column order right. Sort by vApp. Force table formatting and auto-width.
$objects | select-Object name,vapp,cpuCount,memoryGB,storageGB | Sort-Object -Property vapp | Format-Table -AutoSize

[/sourcecode]
<div style="text-align:Left;font-family:Segoe UI;font-style:normal;font-weight:normal;font-size:12px;color:#000000;">
<p style="font-family:Lucida Console;margin:0;background-color:#ffffff;"></p>

</div>
You can easily export to a CSV by using <span style="color:#3366ff;">Export-CSV</span>Â or just run the report to get output that looks something like this:

<a href="http://geekafterfive.files.wordpress.com/2013/03/snag-0380.png"><img class="alignnone size-full wp-image-813" alt="VMreport" src="http://geekafterfive.files.wordpress.com/2013/03/snag-0380.png" width="490" height="211" /></a>
